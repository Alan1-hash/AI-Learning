<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI学习助手 - 大学生专属</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px 0;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4a6baf;
        }
        
        .auth-buttons a {
            margin-left: 15px;
            padding: 8px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
        }
        
        .signup {
            background-color: #4a6baf;
            color: white;
        }
        
        .login {
            border: 1px solid #4a6baf;
            color: #4a6baf;
        }
        
        .hero {
            text-align: center;
            padding: 60px 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            color: #4a5568;
        }
        
        .slider-container {
            width: 100%;
            max-width: 900px;
            margin: 40px auto;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .slider-nav {
            text-align: center;
            margin-top: 15px;
        }
        
        .slider-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin: 0 5px;
            background-color: #ccc;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .slider-dot:hover {
            background-color: #7a92c4;
        }
        
        .slider-dot.active {
            background-color: #4a6baf;
        }
        
        .slider {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .slide {
            min-width: 100%;
            position: relative;
        }
        
        .slide img {
            width: 100%;
            display: block;
        }
        
        .slide-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .info-section {
            background-color: white;
            padding: 60px 0;
            text-align: center;
        }
        
        .info-section h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .info-section p {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
            color: #4a5568;
        }
        
        .video-section {
            padding: 60px 0;
            background-color: #f5f7fa;
            text-align: center;
        }
        
        .video-container {
            max-width: 800px;
            margin: 30px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        video {
            width: 100%;
            display: block;
        }
        
        .testimonials {
            padding: 60px 0;
            background-color: white;
        }
        
        .testimonials h2 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            color: #2c3e50;
        }
        
        .testimonial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .testimonial {
            background-color: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .testimonial-text {
            font-style: italic;
            margin-bottom: 15px;
        }
        
        .stars {
            color: #f39c12;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 60px;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }
            
            .auth-buttons {
                margin-top: 15px;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
        }

        /* 加载动画 */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4a6baf;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 错误提示样式 */
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 4px;
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
            border-left: 4px solid #c62828;
            display: none;
        }
        
        .retry-button {
            background-color: #4a6baf;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .retry-button:hover {
            background-color: #3a5a9f;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">AI学习助手</div>
                <div class="auth-buttons">
                    <a href="#" class="login">登录</a>
                    <a href="#" class="signup">注册</a>
                </div>
            </div>
        </div>
    </header>
    
    <section class="hero">
        <div class="container">
            <h1>大学生专属AI学习助手</h1>
            <p>帮助您更高效地学习和研究</p>
        </div>
    </section>
    
    <div class="container">
        <div id="sliderError" class="error-message"></div>
        <div class="slider-container">
            <div class="slider" id="imageSlider">
                <!-- 幻灯片内容将动态加载 -->
            </div>
            <div class="slider-nav" id="sliderDots">
                <!-- 导航点将动态加载 -->
            </div>
        </div>
        <div class="loader" id="sliderLoader"></div>
    </div>
    
    <section class="info-section">
        <div class="container">
            <h2>我们的优势</h2>
            <p>利用AI技术为您提供个性化的学习体验</p>
        </div>
    </section>
    
    <section class="video-section">
        <div class="container">
            <div id="videoError" class="error-message"></div>
            <h2>产品演示</h2>
            <div class="video-container">
                <video controls id="demoVideo">
                    <!-- 视频将动态加载 -->
                    您的浏览器不支持视频播放。
                </video>
            </div>
            <div class="loader" id="videoLoader"></div>
        </div>
    </section>
    
    <section class="testimonials">
        <div class="container">
            <div id="testimonialError" class="error-message"></div>
            <h2>用户评价</h2>
            <div class="testimonial-grid" id="testimonialGrid">
                <!-- 用户评价将动态加载 -->
            </div>
            <div class="loader" id="testimonialLoader"></div>
        </div>
    </section>
    
    <footer>
        <div class="container">
            <p>© 2023 AI学习助手 版权所有</p>
        </div>
    </footer>
    
    <script>
        // 全局变量
        let currentSlide = 0;
        let slideInterval;
        let hoverTimer;
        let mediaData = [];
        let testimonialsData = [];
        
        // 获取当前环境的基础API URL
        function getApiBaseUrl() {
            // 如果是本地开发环境
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:3000';
            }
            // 生产环境使用相对路径
            return '';
        }

        // DOM加载完成后初始化页面
        document.addEventListener('DOMContentLoaded', async () => {
            // 显示所有加载动画
            document.querySelectorAll('.loader').forEach(loader => {
                loader.style.display = 'block';
            });

            try {
                // 获取所有需要的数据
                await Promise.all([
                    fetchMediaData(),
                    fetchTestimonials()
                ]);

                // 渲染所有组件
                renderSlider();
                renderVideo();
                renderTestimonials();

                // 初始化轮播
                initSlider();
            } catch (error) {
                console.error('页面初始化错误:', error);
                showError('加载数据时出错，请刷新页面重试');
            } finally {
                // 隐藏所有加载动画
                document.querySelectorAll('.loader').forEach(loader => {
                    loader.style.display = 'none';
                });
            }
        });

        // 显示错误信息
        function showError(message, elementId = null) {
            if (elementId) {
                const errorElement = document.getElementById(elementId);
                if (errorElement) {
                    errorElement.innerHTML = `${message} <button class="retry-button" onclick="location.reload()">重试</button>`;
                    errorElement.style.display = 'block';
                }
            } else {
                document.querySelectorAll('.error-message').forEach(el => {
                    el.innerHTML = `${message} <button class="retry-button" onclick="location.reload()">重试</button>`;
                    el.style.display = 'block';
                });
            }
        }

        // 从后端API获取媒体数据
        async function fetchMediaData() {
            try {
                const apiBaseUrl = getApiBaseUrl();
                const response = await fetch(`${apiBaseUrl}/api/media`);
                
                if (!response.ok) {
                    throw new Error(`请求失败: ${response.status}`);
                }
                
                mediaData = await response.json();
                
                if (!Array.isArray(mediaData)) {
                    throw new Error('返回的数据格式不正确');
                }
            } catch (error) {
                console.error('获取媒体数据失败:', error);
                showError('无法加载幻灯片数据: ' + error.message, 'sliderError');
                
                // 提供模拟数据作为后备
                mediaData = [
                    { 
                        id: 1, 
                        type: 'image', 
                        url: 'https://via.placeholder.com/800x400?text=示例图片1', 
                        alt_text: '示例图片1',
                        caption: '示例图片说明'
                    },
                    { 
                        id: 2, 
                        type: 'image', 
                        url: 'https://via.placeholder.com/800x400?text=示例图片2', 
                        alt_text: '示例图片2',
                        caption: '示例图片说明'
                    }
                ];
            }
        }

        // 从后端API获取用户评价数据
        async function fetchTestimonials() {
            try {
                const apiBaseUrl = getApiBaseUrl();
                const response = await fetch(`${apiBaseUrl}/api/testimonials`);
                
                if (!response.ok) {
                    throw new Error(`请求失败: ${response.status}`);
                }
                
                testimonialsData = await response.json();
                
                if (!Array.isArray(testimonialsData)) {
                    throw new Error('返回的数据格式不正确');
                }
            } catch (error) {
                console.error('获取用户评价失败:', error);
                showError('无法加载用户评价: ' + error.message, 'testimonialError');
                
                // 提供模拟数据作为后备
                testimonialsData = [
                    { id: 1, text: '这个AI学习助手非常有用！', rating: 5 },
                    { id: 2, text: '帮助我提高了学习效率', rating: 4 },
                    { id: 3, text: '界面友好，功能强大', rating: 5 }
                ];
            }
        }

        // 渲染轮播图
        function renderSlider() {
            const slider = document.getElementById('imageSlider');
            const dotsContainer = document.getElementById('sliderDots');
            
            // 清空现有内容
            slider.innerHTML = '';
            dotsContainer.innerHTML = '';
            
            // 过滤出图片类型数据
            const images = mediaData.filter(item => item.type === 'image');
            
            // 如果没有图片数据，显示默认内容
            if (images.length === 0) {
                slider.innerHTML = `
                    <div class="slide">
                        <img src="https://via.placeholder.com/800x400?text=暂无图片数据" alt="默认图片">
                        <div class="slide-caption">暂无图片数据</div>
                    </div>
                `;
                return;
            }
            
            // 动态创建幻灯片
            images.forEach((image, index) => {
                const slide = document.createElement('div');
                slide.className = 'slide';
                slide.innerHTML = `
                    <img src="${image.url}" alt="${image.alt_text || '幻灯片图片'}">
                    <div class="slide-caption">${image.caption || ''}</div>
                `;
                slider.appendChild(slide);
                
                // 创建导航点
                const dot = document.createElement('span');
                dot.className = 'slider-dot' + (index === 0 ? ' active' : '');
                dot.setAttribute('data-index', index);
                dotsContainer.appendChild(dot);
            });
        }

        // 渲染视频
        function renderVideo() {
            const videoElement = document.getElementById('demoVideo');
            const videoSource = mediaData.find(item => item.type === 'video');
            
            if (videoSource) {
                videoElement.innerHTML = `
                    <source src="${videoSource.url}" type="video/mp4">
                    您的浏览器不支持视频播放。
                `;
                videoElement.load();
                
                // 设置视频循环播放
                videoElement.addEventListener('play', function() {
                    this.loop = true;
                });
            } else {
                showError('暂无视频数据', 'videoError');
                videoElement.innerHTML = `
                    <source src="https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4" type="video/mp4">
                    暂无视频数据
                `;
            }
        }

        // 渲染用户评价
        function renderTestimonials() {
            const testimonialGrid = document.getElementById('testimonialGrid');
            
            // 清空现有内容
            testimonialGrid.innerHTML = '';
            
            // 如果没有评价数据，显示默认内容
            if (testimonialsData.length === 0) {
                testimonialGrid.innerHTML = `
                    <div class="testimonial">
                        <div class="stars">★★★★★</div>
                        <p class="testimonial-text">暂无用户评价</p>
                    </div>
                `;
                return;
            }
            
            // 动态创建用户评价
            testimonialsData.forEach(testimonial => {
                const testimonialElement = document.createElement('div');
                testimonialElement.className = 'testimonial';
                testimonialElement.innerHTML = `
                    <div class="stars">${'★'.repeat(testimonial.rating || 5)}</div>
                    <p class="testimonial-text">${testimonial.text || '暂无评价内容'}</p>
                `;
                testimonialGrid.appendChild(testimonialElement);
            });
        }

        // 初始化轮播功能
        function initSlider() {
            const slider = document.querySelector('.slider');
            const dots = document.querySelectorAll('.slider-dot');
            const sliderContainer = document.querySelector('.slider-container');
            const slides = document.querySelectorAll('.slide');
            
            // 如果没有幻灯片，不初始化轮播
            if (slides.length === 0) return;
            
            // 重置当前幻灯片索引
            currentSlide = 0;
            
            // 更新导航点状态
            function updateDots() {
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === currentSlide);
                });
            }
            
            // 跳转到指定幻灯片
            function goToSlide(index) {
                slider.style.transform = `translateX(-${index * 100}%)`;
                currentSlide = index;
                updateDots();
            }
            
            // 下一张幻灯片
            function nextSlide() {
                const newIndex = (currentSlide + 1) % slides.length;
                goToSlide(newIndex);
            }
            
            // 开始自动轮播
            function startSlider() {
                clearInterval(slideInterval);
                slideInterval = setInterval(nextSlide, 3000);
            }
            
            // 初始化导航点点击事件
            dots.forEach(dot => {
                dot.addEventListener('click', function() {
                    const targetIndex = parseInt(this.getAttribute('data-index'));
                    if (targetIndex !== currentSlide) {
                        goToSlide(targetIndex);
                        startSlider();
                    }
                });
            });
            
            // 鼠标悬停控制
            sliderContainer.addEventListener('mouseenter', () => {
                clearInterval(slideInterval);
                clearTimeout(hoverTimer);
            });
            
            sliderContainer.addEventListener('mouseleave', startSlider);
            
            // 初始化轮播
            startSlider();
        }
    </script>
</body>
</html>